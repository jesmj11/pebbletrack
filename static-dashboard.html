<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homeschool Dashboard</title>
    <style>
        /* Pebble Track Color Palette */
        :root {
            --pebble-gray: #7E8A97;
            --moss-green: #8BA88E;
            --stream-blue: #A8C7DD;
            --drift-sand: #F5F2EA;
            --charcoal-slate: #3E4A59;
            --fern-mist: #D9E5D1;
            --light-border: #e2e8f0;
            --warm-cream: #fef7ed;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--drift-sand);
            color: var(--charcoal-slate);
            min-height: 100vh;
            line-height: 1.6;
        }

        .navbar {
            background: white;
            border-bottom: 2px solid var(--fern-mist);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            color: var(--charcoal-slate);
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--pebble-gray);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 2px solid transparent;
        }

        .nav-links a:hover {
            color: var(--moss-green);
            background-color: var(--fern-mist);
        }

        .nav-links a.active {
            color: var(--moss-green);
            background-color: var(--fern-mist);
            border-color: var(--moss-green);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--fern-mist);
        }

        .card h2 {
            color: var(--charcoal-slate);
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--moss-green);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--pebble-gray);
            font-size: 1rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            background: var(--moss-green);
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            text-align: center;
            display: block;
        }

        .action-btn:hover {
            background: var(--charcoal-slate);
        }

        .ai-btn {
            background: linear-gradient(135deg, var(--stream-blue), var(--moss-green));
        }

        .ai-btn:hover {
            background: linear-gradient(135deg, var(--moss-green), var(--stream-blue));
        }

        /* AI Interface Modal */
        .ai-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .ai-modal-content {
            background: var(--drift-sand);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .ai-modal h2 {
            color: var(--charcoal-slate);
            margin-bottom: 1rem;
        }

        .file-upload-area {
            border: 2px dashed var(--pebble-gray);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            border-color: var(--moss-green);
            background-color: var(--fern-mist);
        }

        .file-upload-area.dragover {
            border-color: var(--moss-green);
            background-color: var(--fern-mist);
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .analysis-results {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--fern-mist);
            border-radius: 8px;
        }

        .lesson-item {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border-left: 4px solid var(--moss-green);
        }

        .lesson-title {
            font-weight: bold;
            color: var(--charcoal-slate);
        }

        .lesson-meta {
            font-size: 0.9rem;
            color: var(--pebble-gray);
            margin-top: 0.5rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--moss-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--charcoal-slate);
        }

        .btn-secondary {
            background: var(--pebble-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--charcoal-slate);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--pebble-gray);
        }

        .loading:after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--pebble-gray);
            border-top: 2px solid var(--moss-green);
            border-radius: 50%;
            display: inline-block;
            margin-left: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Curriculum Management Styles */
        .curriculum-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .curriculum-item {
            background: var(--fern-mist);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--moss-green);
        }

        .curriculum-header h3 {
            margin: 0 0 0.25rem 0;
            color: var(--charcoal-slate);
            font-size: 1.1rem;
        }

        .curriculum-meta {
            color: var(--pebble-gray);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .curriculum-details p {
            margin: 0.5rem 0;
            color: var(--charcoal-slate);
            font-size: 0.9rem;
        }

        .curriculum-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--pebble-gray);
            margin: 0.5rem 0;
        }

        .curriculum-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .empty-state,
        .error-state {
            text-align: center;
            padding: 2rem;
            color: var(--pebble-gray);
        }

        .empty-state p,
        .error-state p {
            margin: 0.5rem 0;
        }

        /* Curriculum Import Modal Styles */
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--light-border);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--pebble-gray);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: var(--fern-mist);
            color: var(--charcoal-slate);
        }

        .import-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-border);
        }

        .tab-button {
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: var(--pebble-gray);
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: var(--fern-mist);
            color: var(--charcoal-slate);
        }

        .tab-button.active {
            border-bottom-color: var(--moss-green);
            color: var(--moss-green);
            background: var(--fern-mist);
        }

        .import-tab {
            display: none;
        }

        .import-tab.active {
            display: block;
        }

        .import-tab h3 {
            color: var(--charcoal-slate);
            margin-bottom: 0.5rem;
        }

        .import-tab p {
            color: var(--pebble-gray);
            margin-bottom: 1rem;
        }

        .template-download {
            background: var(--warm-cream);
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .upload-area {
            border: 2px dashed var(--light-border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: var(--fern-mist);
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 1rem 0;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--moss-green);
            background: rgba(139, 168, 142, 0.1);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--charcoal-slate);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .preview-table {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            margin: 1rem 0;
            background: white;
        }

        .preview-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-table th,
        .preview-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--light-border);
        }

        .preview-table th {
            background: var(--fern-mist);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .lesson-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .lesson-type-lesson { background: #dbeafe; color: #1e40af; }
        .lesson-type-quiz { background: #fef3c7; color: #92400e; }
        .lesson-type-test { background: #fecaca; color: #991b1b; }
        .lesson-type-review { background: #d1fae5; color: #065f46; }

        .manual-lesson-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            padding: 1rem;
            background: white;
        }

        .lesson-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .lesson-item:last-child {
            border-bottom: none;
        }

        .modal-actions {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--fern-mist);
        }

        .activity-item {
            padding: 1rem 0;
            border-bottom: 1px solid var(--fern-mist);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-text {
            color: var(--charcoal-slate);
        }

        .activity-time {
            color: var(--pebble-gray);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>Homeschool Management</h1>
        <div class="nav-links">
            <a href="/static-dashboard" class="active">Dashboard</a>
            <a href="/static-planner">Weekly Planner</a>
            <a href="/curriculum-import">üìö Import Curriculum</a>
            <a href="/static-student">Student View</a>
            <a href="/static-parent">Parent View</a>
            <a href="/login" onclick="logout()">Logout</a>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-bottom: 2rem; color: var(--charcoal-slate);">Welcome to Your Dashboard</h1>

        <div class="dashboard-grid">
            <div class="card">
                <h2>Students</h2>
                <div class="stat-number" id="studentCount">2</div>
                <div class="stat-label">Active Students</div>
            </div>

            <div class="card">
                <h2>Classs Today</h2>
                <div class="stat-number" id="todayClasss">5</div>
                <div class="stat-label">Pending Classs</div>
            </div>

            <div class="card">
                <h2>Completed This Week</h2>
                <div class="stat-number" id="weeklyCompleted">12</div>
                <div class="stat-label">Classs Completed</div>
            </div>

            <div class="card">
                <h2>Overall Progress</h2>
                <div class="stat-number" id="overallProgress">85%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <div class="quick-actions">
            <a href="/static-planner" class="action-btn">üìÖ Weekly Planner</a>
            <button class="action-btn ai-btn" onclick="openCurriculumImport()">üì∏ Import Curriculum</button>
            <button class="action-btn" onclick="showCurriculumManager()">üìö Manage Curriculums</button>
            <a href="/student-view" class="action-btn">üë®‚Äçüéì Student Login</a>
            <a href="/parent-view" class="action-btn">üìä Parent Reports</a>
        </div>

        <div class="recent-activity">
            <h2 style="margin-bottom: 1.5rem; color: var(--charcoal-slate);">Recent Activity</h2>
            <div id="activityContainer">
                <div class="activity-item">
                    <div class="activity-text">Emma completed Math worksheet</div>
                    <div class="activity-time">2 hours ago</div>
                </div>
                <div class="activity-item">
                    <div class="activity-text">New reading assignment added for Liam</div>
                    <div class="activity-time">4 hours ago</div>
                </div>
                <div class="activity-item">
                    <div class="activity-text">Science project submitted by Emma</div>
                    <div class="activity-time">1 day ago</div>
                </div>
                <div class="activity-item">
                    <div class="activity-text">Parent-teacher conference scheduled</div>
                    <div class="activity-time">2 days ago</div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Curriculum Analysis Modal -->
    <div id="aiModal" class="ai-modal">
        <div class="ai-modal-content">
            <h2>AI Curriculum Import</h2>
            <p>Upload an image of your curriculum index or table of contents to automatically extract and add lessons to your planner.</p>
            
            <div class="file-upload-area" id="uploadArea">
                <div id="uploadContent">
                    <p><strong>Click to select an image</strong></p>
                    <p>or drag and drop here</p>
                    <small>Supports: JPG, PNG, PDF pages</small>
                </div>
                <img id="previewImage" class="preview-image" style="display: none;">
            </div>
            
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
            
            <div id="analysisResults" class="analysis-results" style="display: none;">
                <h3>Extracted Lessons:</h3>
                <div id="lessonsList"></div>
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeAIInterface()">Cancel</button>
                <button class="btn btn-primary" id="addLessonsBtn" onclick="addLessonsToPlanner()" style="display: none;">Add to Planner</button>
            </div>
        </div>
    </div>

    <!-- Curriculum Management Modal -->
    <div id="curriculumModal" class="ai-modal">
        <div class="ai-modal-content">
            <h2>Curriculum Manager</h2>
            <p>Manage your homeschool curriculums and view imported lessons.</p>
            
            <div class="curriculum-list" id="curriculumList">
                <div class="loading">Loading curriculums...</div>
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeCurriculumManager()">Close</button>
                <button class="btn btn-primary" onclick="openCurriculumImport(); closeCurriculumManager();">üì∏ Import New Curriculum</button>
            </div>
        </div>
    </div>

    <!-- Curriculum Import Modal -->
    <div id="curriculumImportModal" class="ai-modal" style="display: none;">
        <div class="ai-modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>üìö Import Curriculum</h2>
                <button class="modal-close" onclick="closeCurriculumImport()">√ó</button>
            </div>
            
            <!-- Import Method Tabs -->
            <div class="import-tabs">
                <button class="tab-button active" onclick="showImportTab('csv')">üìä CSV/Excel</button>
                <button class="tab-button" onclick="showImportTab('paste')">üìã Copy-Paste</button>
                <button class="tab-button" onclick="showImportTab('manual')">‚úèÔ∏è Manual</button>
                <button class="tab-button" onclick="showImportTab('template')">üìö Templates</button>
            </div>

            <!-- CSV Import Tab -->
            <div id="csvTab" class="import-tab active">
                <h3>üìä CSV/Excel Import</h3>
                <p>Upload a spreadsheet with your lesson structure. Perfect for bulk imports.</p>
                
                <div class="template-download">
                    <strong>üì• Download Template:</strong>
                    <button class="btn btn-sm btn-secondary" onclick="downloadCSVTemplate()">Download CSV Template</button>
                </div>

                <div class="upload-area" id="csvUploadArea">
                    <input type="file" id="csvFile" accept=".csv,.xlsx,.xls" style="display: none;">
                    <div id="csvUploadContent">
                        üìÅ Drag & drop your file here or click to browse
                    </div>
                </div>

                <div id="csvPreview" style="display: none;">
                    <h4>Preview:</h4>
                    <div class="preview-table" id="csvPreviewTable"></div>
                    <div class="modal-actions">
                        <button class="btn" onclick="importCSVData()">Import Lessons</button>
                    </div>
                </div>
            </div>

            <!-- Copy-Paste Tab -->
            <div id="pasteTab" class="import-tab">
                <h3>üìã Copy-Paste Parser</h3>
                <p>Copy lesson lists from websites and let our smart parser extract the structure.</p>
                
                <div class="form-group">
                    <label for="pasteContent">Paste content from curriculum website:</label>
                    <textarea id="pasteContent" rows="8" placeholder="Example:
Lesson 1: Introduction to Fractions
Lesson 2: Adding Fractions
Quiz 1: Fractions Review
Lesson 3: Subtracting Fractions
Test 1: Fractions Assessment"></textarea>
                </div>

                <button class="btn" onclick="parseContent()">Parse Lessons</button>

                <div id="parsePreview" style="display: none;">
                    <h4>Parsed Results:</h4>
                    <div class="preview-table" id="parsePreviewTable"></div>
                    <div class="modal-actions">
                        <button class="btn" onclick="importParsedData()">Import Parsed Lessons</button>
                    </div>
                </div>
            </div>

            <!-- Manual Entry Tab -->
            <div id="manualTab" class="import-tab">
                <h3>‚úèÔ∏è Manual Entry</h3>
                <p>Add lessons one by one with full control over details.</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div class="form-group">
                            <label for="manualCurriculumName">Curriculum Name:</label>
                            <input type="text" id="manualCurriculumName" placeholder="e.g., Saxon Math 8/7">
                        </div>
                        
                        <div class="form-group">
                            <label for="manualCurriculumSubject">Subject:</label>
                            <select id="manualCurriculumSubject">
                                <option value="Math">Math</option>
                                <option value="English">English</option>
                                <option value="Science">Science</option>
                                <option value="History">History</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="manualLessonTitle">Lesson Title:</label>
                            <input type="text" id="manualLessonTitle" placeholder="e.g., Adding Fractions">
                        </div>

                        <div class="form-group">
                            <label for="manualLessonType">Lesson Type:</label>
                            <select id="manualLessonType">
                                <option value="lesson">Lesson</option>
                                <option value="quiz">Quiz</option>
                                <option value="test">Test</option>
                                <option value="review">Review</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="manualLessonMinutes">Estimated Minutes:</label>
                            <input type="number" id="manualLessonMinutes" value="30" min="5" max="180">
                        </div>

                        <button class="btn" onclick="addManualLesson()">Add Lesson</button>
                    </div>

                    <div>
                        <h4>Lessons Added:</h4>
                        <div class="manual-lesson-list" id="manualLessonList">
                            <em>No lessons added yet</em>
                        </div>
                        
                        <div style="margin-top: 1rem;">
                            <button class="btn" onclick="saveManualCurriculum()">Save Curriculum</button>
                            <button class="btn btn-secondary" onclick="clearManualLessons()">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Tab -->
            <div id="templateTab" class="import-tab">
                <h3>üìö Template Library</h3>
                <p>Use pre-built lesson structures for popular curricula.</p>
                
                <div class="form-group">
                    <label for="templateSelector">Choose Template:</label>
                    <select id="templateSelector">
                        <option value="">Select a template...</option>
                    </select>
                </div>

                <button class="btn" onclick="loadSelectedTemplate()">Load Template</button>

                <div id="templatePreview" style="display: none;">
                    <h4>Template Preview:</h4>
                    <div class="preview-table" id="templatePreviewTable"></div>
                    <div class="modal-actions">
                        <button class="btn" onclick="importSelectedTemplate()">Import Template</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load students
                const studentsResponse = await fetch('/api/planner/students');
                if (studentsResponse.ok) {
                    const students = await studentsResponse.json();
                    document.getElementById('studentCount').textContent = students.length;
                }

                // Load classs
                const classsResponse = await fetch('/api/planner/classs');
                if (classsResponse.ok) {
                    const classs = await classsResponse.json();
                    const pendingClasss = classs.filter(t => !t.completed);
                    const completedClasss = classs.filter(t => t.completed);
                    
                    document.getElementById('todayClasss').textContent = pendingClasss.length;
                    document.getElementById('weeklyCompleted').textContent = completedClasss.length;
                    
                    const progressPercent = classs.length > 0 ? 
                        Math.round((completedClasss.length / classs.length) * 100) : 0;
                    document.getElementById('overallProgress').textContent = progressPercent + '%';
                }
            } catch (error) {
                console.warn('Using offline data for dashboard');
                // Use localStorage fallback or default values
            }
        }

        // Check authentication on page load
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userRole = localStorage.getItem('userRole');
            
            if (!isLoggedIn || userRole !== 'teacher') {
                window.location.href = '/login';
                return false;
            }
            return true;
        }

        function logout() {
            localStorage.removeItem('userRole');
            localStorage.removeItem('isLoggedIn');
        }

        // AI Curriculum Interface
        let extractedLessons = [];

        function openAIInterface() {
            document.getElementById('aiModal').style.display = 'flex';
        }

        function closeAIInterface() {
            document.getElementById('aiModal').style.display = 'none';
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('uploadContent').style.display = 'block';
            document.getElementById('analysisResults').style.display = 'none';
            document.getElementById('addLessonsBtn').style.display = 'none';
            extractedLessons = [];
        }

        // File upload handling
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const previewImage = document.getElementById('previewImage');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
                document.getElementById('uploadContent').style.display = 'none';
                analyzeCurriculum(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function analyzeCurriculum(imageData) {
            const resultsDiv = document.getElementById('analysisResults');
            const lessonsList = document.getElementById('lessonsList');
            
            resultsDiv.style.display = 'block';
            lessonsList.innerHTML = '<div class="loading">Analyzing curriculum image...</div>';

            try {
                const response = await fetch('/api/curriculum/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ image: imageData })
                });

                if (!response.ok) {
                    throw new Error('Failed to analyze image');
                }

                const data = await response.json();
                extractedLessons = data.lessons || [];

                if (extractedLessons.length === 0) {
                    lessonsList.innerHTML = '<p>No lessons found in the image. Please try with a clearer image of a curriculum index.</p>';
                    return;
                }

                lessonsList.innerHTML = extractedLessons.map(lesson => `
                    <div class="lesson-item">
                        <div class="lesson-title">${lesson.title}</div>
                        <div class="lesson-meta">
                            Subject: ${lesson.subject} | Grade: ${lesson.gradeLevel}
                            ${lesson.description ? ` | ${lesson.description}` : ''}
                            ${lesson.estimatedDuration ? ` | Duration: ${lesson.estimatedDuration}` : ''}
                        </div>
                    </div>
                `).join('');

                document.getElementById('addLessonsBtn').style.display = 'block';

            } catch (error) {
                console.error('Error analyzing curriculum:', error);
                lessonsList.innerHTML = '<p style="color: red;">Error analyzing image. Please try again or check your connection.</p>';
            }
        }

        async function addLessonsToPlanner() {
            if (extractedLessons.length === 0) return;

            const addBtn = document.getElementById('addLessonsBtn');
            const originalText = addBtn.textContent;
            addBtn.textContent = 'Adding...';
            addBtn.disabled = true;

            try {
                // Add lessons as classs to the planner
                for (const lesson of extractedLessons) {
                    const class = {
                        id: Date.now() + Math.random(),
                        title: lesson.title,
                        subject: lesson.subject,
                        description: lesson.description || '',
                        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 1 week from now
                        completed: false,
                        studentId: '', // All students
                        gradeLevel: lesson.gradeLevel
                    };

                    // Try to save online first
                    try {
                        const response = await fetch('/api/planner/classs', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(class)
                        });
                        
                        if (!response.ok) throw new Error('API request failed');
                    } catch (error) {
                        console.warn('Failed to save online, saving locally');
                        // Save to localStorage as fallback
                        const classs = JSON.parse(localStorage.getItem('homeschool_classs') || '[]');
                        classs.push(class);
                        localStorage.setItem('homeschool_classs', JSON.stringify(classs));
                    }
                }

                alert(`Successfully added ${extractedLessons.length} lessons to your planner!`);
                closeAIInterface();

            } catch (error) {
                console.error('Error adding lessons:', error);
                alert('Error adding lessons. Please try again.');
            } finally {
                addBtn.textContent = originalText;
                addBtn.disabled = false;
            }
        }

        // Curriculum Management Functions
        function showCurriculumManager() {
            document.getElementById('curriculumModal').style.display = 'flex';
            loadCurriculumList();
        }

        function closeCurriculumManager() {
            document.getElementById('curriculumModal').style.display = 'none';
        }

        async function loadCurriculumList() {
            const curriculumList = document.getElementById('curriculumList');
            curriculumList.innerHTML = '<div class="loading">Loading curriculums...</div>';

            try {
                const response = await fetch('/api/curriculums');
                if (response.ok) {
                    const curriculums = await response.json();
                    
                    if (curriculums.length === 0) {
                        curriculumList.innerHTML = `
                            <div class="empty-state">
                                <p>No curriculums imported yet.</p>
                                <p>Click "üì∏ Import New Curriculum" to get started!</p>
                            </div>
                        `;
                        return;
                    }

                    curriculumList.innerHTML = curriculums.map(curriculum => `
                        <div class="curriculum-item">
                            <div class="curriculum-header">
                                <h3>${curriculum.name}</h3>
                                <span class="curriculum-meta">${curriculum.subject} ‚Ä¢ ${curriculum.gradeLevel || 'All Grades'}</span>
                            </div>
                            <div class="curriculum-details">
                                <p>${curriculum.description || 'No description available'}</p>
                                <div class="curriculum-stats">
                                    <span>üìö ${curriculum.totalLessons} lessons</span>
                                    <span>üìÖ Created ${new Date(curriculum.createdAt).toLocaleDateString()}</span>
                                </div>
                            </div>
                            <div class="curriculum-actions">
                                <button class="btn btn-sm" onclick="viewCurriculumLessons(${curriculum.id})">View Lessons</button>
                                <button class="btn btn-sm btn-secondary" onclick="assignCurriculum(${curriculum.id})">Assign to Student</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    throw new Error('Failed to load curriculums');
                }
            } catch (error) {
                console.error('Error loading curriculums:', error);
                curriculumList.innerHTML = `
                    <div class="error-state">
                        <p style="color: red;">Failed to load curriculums.</p>
                        <p>You can still <a href="/curriculum-import">import new curriculums here</a>.</p>
                    </div>
                `;
            }
        }

        async function viewCurriculumLessons(curriculumId) {
            try {
                const response = await fetch(`/api/curriculums/${curriculumId}/lessons`);
                if (response.ok) {
                    const lessons = await response.json();
                    
                    const lessonsList = lessons.map(lesson => 
                        `<div class="lesson-preview">
                            <span class="lesson-number">${lesson.lessonNumber}</span>
                            <span class="lesson-title">${lesson.title}</span>
                            <span class="lesson-type lesson-type-${lesson.type}">${lesson.type}</span>
                            <span class="lesson-duration">${lesson.estimatedMinutes}min</span>
                        </div>`
                    ).join('');

                    alert(`Lessons Preview:\n\n${lessons.slice(0, 10).map(l => 
                        `${l.lessonNumber}. ${l.title} (${l.type}, ${l.estimatedMinutes}min)`
                    ).join('\n')}${lessons.length > 10 ? `\n... and ${lessons.length - 10} more lessons` : ''}`);
                } else {
                    alert('Failed to load lessons');
                }
            } catch (error) {
                console.error('Error viewing lessons:', error);
                alert('Error loading lessons');
            }
        }

        function assignCurriculum(curriculumId) {
            alert('Curriculum assignment feature coming soon! For now, you can manually schedule lessons in the Weekly Planner.');
        }

        // Curriculum Import Modal Functions
        let csvData = [];
        let parsedData = [];
        let manualLessons = [];

        function openCurriculumImport() {
            document.getElementById('curriculumImportModal').style.display = 'flex';
            loadTemplateOptions();
        }

        function closeCurriculumImport() {
            document.getElementById('curriculumImportModal').style.display = 'none';
            resetAllTabs();
        }

        function showImportTab(tabName) {
            // Hide all tabs and deactivate buttons
            document.querySelectorAll('.import-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab and activate button
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function resetAllTabs() {
            csvData = [];
            parsedData = [];
            manualLessons = [];
            
            document.getElementById('csvPreview').style.display = 'none';
            document.getElementById('parsePreview').style.display = 'none';
            document.getElementById('templatePreview').style.display = 'none';
            
            document.getElementById('csvFile').value = '';
            document.getElementById('pasteContent').value = '';
            document.getElementById('manualLessonList').innerHTML = '<em>No lessons added yet</em>';
            document.getElementById('templateSelector').value = '';
        }

        // CSV Import Functions
        function downloadCSVTemplate() {
            const csvContent = `Lesson Number,Title,Type,Estimated Minutes,Description
1,Introduction to Fractions,lesson,30,Basic fraction concepts
2,Adding Fractions,lesson,35,Adding fractions with common denominators
3,Fractions Quiz,quiz,20,Assessment of fraction basics
4,Subtracting Fractions,lesson,35,Subtracting fractions with common denominators
5,Mixed Numbers,lesson,40,Converting between improper fractions and mixed numbers
6,Fractions Test,test,45,Comprehensive fractions assessment`;

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pebbletrack-curriculum-template.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // CSV Upload handling
        document.addEventListener('DOMContentLoaded', function() {
            const csvUploadArea = document.getElementById('csvUploadArea');
            const csvFileInput = document.getElementById('csvFile');

            if (csvUploadArea) {
                csvUploadArea.addEventListener('click', () => csvFileInput.click());

                csvUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    csvUploadArea.classList.add('dragover');
                });

                csvUploadArea.addEventListener('dragleave', () => {
                    csvUploadArea.classList.remove('dragover');
                });

                csvUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    csvUploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleCSVFile(files[0]);
                    }
                });

                csvFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        handleCSVFile(e.target.files[0]);
                    }
                });
            }
        });

        function handleCSVFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                csvData = parseCSV(text);
                displayCSVPreview(csvData);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }
            return data;
        }

        function displayCSVPreview(data) {
            if (data.length === 0) return;
            
            const preview = document.getElementById('csvPreview');
            const table = document.getElementById('csvPreviewTable');
            
            let html = '<table><thead><tr>';
            const headers = Object.keys(data[0]);
            headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            data.slice(0, 10).forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    let value = row[header];
                    if (header.toLowerCase().includes('type')) {
                        value = `<span class="lesson-type-badge lesson-type-${value}">${value}</span>`;
                    }
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            if (data.length > 10) {
                html += `<p><em>... and ${data.length - 10} more rows</em></p>`;
            }
            
            table.innerHTML = html;
            preview.style.display = 'block';
        }

        async function importCSVData() {
            try {
                const curriculumName = prompt('Enter curriculum name:');
                const curriculumSubject = prompt('Enter subject (Math, Science, English, etc.):');
                
                if (!curriculumName || !curriculumSubject) {
                    alert('Curriculum name and subject are required');
                    return;
                }
                
                const response = await fetch('/api/curriculums/import/csv', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        curriculumName,
                        curriculumSubject,
                        lessons: csvData.map(row => ({
                            lessonNumber: parseInt(row['Lesson Number']) || undefined,
                            title: row['Title'] || row['title'] || '',
                            type: row['Type'] || row['type'] || 'lesson',
                            estimatedMinutes: parseInt(row['Estimated Minutes']) || parseInt(row['estimated_minutes']) || 30,
                            description: row['Description'] || row['description'] || ''
                        }))
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Successfully imported "${result.curriculum.name}" with ${result.lessonsImported} lessons!`);
                    closeCurriculumImport();
                    loadCurriculumList(); // Refresh the curriculum list
                } else {
                    const error = await response.json();
                    alert(`Import failed: ${error.error}`);
                }
            } catch (error) {
                console.error('Error importing CSV data:', error);
                alert('Failed to import CSV data. Please try again.');
            }
        }

        // Copy-Paste Parser Functions
        async function parseContent() {
            const text = document.getElementById('pasteContent').value;
            if (!text.trim()) {
                alert('Please paste some content first');
                return;
            }
            
            try {
                // First try local parsing
                parsedData = smartParseText(text);
                
                // Then enhance with backend parsing
                const response = await fetch('/api/curriculums/parse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: text })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    parsedData = result.lessons;
                    
                    if (result.suggestions && result.suggestions.length > 0) {
                        const suggestionText = result.suggestions.join('\n‚Ä¢ ');
                        alert(`Parsed ${result.lessonsFound} lessons!\n\nSuggestions:\n‚Ä¢ ${suggestionText}`);
                    }
                }
                
                displayParsePreview(parsedData);
            } catch (error) {
                console.error('Error parsing content:', error);
                parsedData = smartParseText(text);
                displayParsePreview(parsedData);
            }
        }

        function smartParseText(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const lessons = [];
            let lessonNumber = 1;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                const numberMatch = line.match(/^(?:Lesson\s*)?(\d+)[:.]?\s*(.+)/i);
                if (numberMatch) {
                    lessonNumber = parseInt(numberMatch[1]);
                    line = numberMatch[2];
                }
                
                let type = 'lesson';
                if (line.toLowerCase().includes('quiz')) type = 'quiz';
                else if (line.toLowerCase().includes('test') || line.toLowerCase().includes('exam')) type = 'test';
                else if (line.toLowerCase().includes('review')) type = 'review';
                
                lessons.push({
                    'Lesson Number': lessonNumber,
                    'Title': line,
                    'Type': type,
                    'Estimated Minutes': type === 'quiz' ? 20 : type === 'test' ? 45 : 30
                });
                
                lessonNumber++;
            });
            
            return lessons;
        }

        function displayParsePreview(data) {
            const preview = document.getElementById('parsePreview');
            const table = document.getElementById('parsePreviewTable');
            
            let html = '<table><thead><tr><th>Lesson #</th><th>Title</th><th>Type</th><th>Minutes</th></tr></thead><tbody>';
            
            data.forEach(lesson => {
                html += `<tr>
                    <td>${lesson['Lesson Number']}</td>
                    <td>${lesson['Title']}</td>
                    <td><span class="lesson-type-badge lesson-type-${lesson['Type']}">${lesson['Type']}</span></td>
                    <td>${lesson['Estimated Minutes']}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            table.innerHTML = html;
            preview.style.display = 'block';
        }

        async function importParsedData() {
            try {
                const curriculumName = prompt('Enter curriculum name:');
                const curriculumSubject = prompt('Enter subject (Math, Science, English, etc.):');
                
                if (!curriculumName || !curriculumSubject) {
                    alert('Curriculum name and subject are required');
                    return;
                }
                
                const response = await fetch('/api/curriculums/import/csv', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        curriculumName,
                        curriculumSubject,
                        lessons: parsedData.map(lesson => ({
                            lessonNumber: lesson['Lesson Number'],
                            title: lesson['Title'],
                            type: lesson['Type'],
                            estimatedMinutes: lesson['Estimated Minutes'],
                            description: ''
                        }))
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Successfully imported "${result.curriculum.name}" with ${result.lessonsImported} lessons!`);
                    closeCurriculumImport();
                    loadCurriculumList();
                } else {
                    const error = await response.json();
                    alert(`Import failed: ${error.error}`);
                }
            } catch (error) {
                console.error('Error importing parsed data:', error);
                alert('Failed to import parsed data. Please try again.');
            }
        }

        // Manual Entry Functions
        function addManualLesson() {
            const title = document.getElementById('manualLessonTitle').value;
            const type = document.getElementById('manualLessonType').value;
            const minutes = document.getElementById('manualLessonMinutes').value;
            
            if (!title.trim()) {
                alert('Please enter a lesson title');
                return;
            }
            
            const lesson = {
                number: manualLessons.length + 1,
                title: title,
                type: type,
                minutes: parseInt(minutes)
            };
            
            manualLessons.push(lesson);
            updateManualLessonList();
            
            // Clear the form
            document.getElementById('manualLessonTitle').value = '';
            document.getElementById('manualLessonMinutes').value = 30;
            document.getElementById('manualLessonTitle').focus();
        }

        function updateManualLessonList() {
            const list = document.getElementById('manualLessonList');
            
            if (manualLessons.length === 0) {
                list.innerHTML = '<em>No lessons added yet</em>';
                return;
            }
            
            let html = '';
            manualLessons.forEach((lesson, index) => {
                html += `
                    <div class="lesson-item">
                        <div>
                            <strong>Lesson ${lesson.number}:</strong> ${lesson.title}
                            <br><small><span class="lesson-type-badge lesson-type-${lesson.type}">${lesson.type}</span> ‚Ä¢ ${lesson.minutes} min</small>
                        </div>
                        <button onclick="removeManualLesson(${index})" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 4px 8px;">√ó</button>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        function removeManualLesson(index) {
            manualLessons.splice(index, 1);
            manualLessons.forEach((lesson, i) => {
                lesson.number = i + 1;
            });
            updateManualLessonList();
        }

        function clearManualLessons() {
            if (manualLessons.length > 0 && !confirm('Clear all lessons? This cannot be undone.')) {
                return;
            }
            manualLessons = [];
            updateManualLessonList();
            document.getElementById('manualCurriculumName').value = '';
        }

        async function saveManualCurriculum() {
            const name = document.getElementById('manualCurriculumName').value;
            const subject = document.getElementById('manualCurriculumSubject').value;
            
            if (!name.trim()) {
                alert('Please enter a curriculum name');
                return;
            }
            
            if (manualLessons.length === 0) {
                alert('Please add at least one lesson');
                return;
            }
            
            try {
                const response = await fetch('/api/curriculums', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        subject,
                        lessons: manualLessons.map(lesson => ({
                            lessonNumber: lesson.number,
                            title: lesson.title,
                            type: lesson.type,
                            estimatedMinutes: lesson.minutes,
                            description: ''
                        }))
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Successfully saved "${result.name}" with ${manualLessons.length} lessons!`);
                    closeCurriculumImport();
                    loadCurriculumList();
                } else {
                    const error = await response.json();
                    alert(`Save failed: ${error.error}`);
                }
            } catch (error) {
                console.error('Error saving manual curriculum:', error);
                alert('Failed to save curriculum. Please try again.');
            }
        }

        // Template Functions
        async function loadTemplateOptions() {
            try {
                const response = await fetch('/api/curriculums/templates');
                if (response.ok) {
                    const templates = await response.json();
                    const select = document.getElementById('templateSelector');
                    
                    // Clear existing options except the first one
                    select.innerHTML = '<option value="">Select a template...</option>';
                    
                    templates.forEach(template => {
                        const option = document.createElement('option');
                        option.value = template.id;
                        option.textContent = `${template.name} (${template.totalLessons} lessons)`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }

        async function loadSelectedTemplate() {
            const templateId = document.getElementById('templateSelector').value;
            if (!templateId) return;
            
            try {
                const response = await fetch(`/api/curriculums/templates/${templateId}`);
                
                if (response.ok) {
                    const template = await response.json();
                    displayTemplatePreview(template);
                } else {
                    alert('Failed to load template');
                }
            } catch (error) {
                console.error('Error loading template:', error);
                alert('Failed to load template. Please try again.');
            }
        }

        function displayTemplatePreview(template) {
            const preview = document.getElementById('templatePreview');
            const table = document.getElementById('templatePreviewTable');
            
            let html = `<p><strong>${template.name}</strong> - ${template.lessons.length} lessons</p>`;
            html += '<table><thead><tr><th>Lesson #</th><th>Title</th><th>Type</th><th>Minutes</th></tr></thead><tbody>';
            
            template.lessons.slice(0, 10).forEach(lesson => {
                html += `<tr>
                    <td>${lesson.lessonNumber}</td>
                    <td>${lesson.title}</td>
                    <td><span class="lesson-type-badge lesson-type-${lesson.type}">${lesson.type}</span></td>
                    <td>${lesson.estimatedMinutes}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            if (template.lessons.length > 10) {
                html += `<p><em>... and ${template.lessons.length - 10} more lessons</em></p>`;
            }
            
            table.innerHTML = html;
            preview.style.display = 'block';
        }

        async function importSelectedTemplate() {
            const templateId = document.getElementById('templateSelector').value;
            if (!templateId) return;
            
            try {
                const response = await fetch(`/api/curriculums/templates/${templateId}`);
                
                if (response.ok) {
                    const template = await response.json();
                    
                    const createResponse = await fetch('/api/curriculums', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: template.name,
                            subject: template.subject,
                            publisher: template.publisher,
                            gradeLevel: template.gradeLevel,
                            description: template.description,
                            lessons: template.lessons
                        })
                    });
                    
                    if (createResponse.ok) {
                        const result = await createResponse.json();
                        alert(`Successfully imported template "${result.name}" with ${template.lessons.length} lessons!`);
                        closeCurriculumImport();
                        loadCurriculumList();
                    } else {
                        const error = await createResponse.json();
                        alert(`Template import failed: ${error.error}`);
                    }
                } else {
                    alert('Failed to load template');
                }
            } catch (error) {
                console.error('Error importing template:', error);
                alert('Failed to import template. Please try again.');
            }
        }

        // Close modals when clicking outside
        document.getElementById('aiModal').addEventListener('click', (e) => {
            if (e.target.id === 'aiModal') {
                closeAIInterface();
            }
        });

        document.getElementById('curriculumModal').addEventListener('click', (e) => {
            if (e.target.id === 'curriculumModal') {
                closeCurriculumManager();
            }
        });

        document.getElementById('curriculumImportModal').addEventListener('click', (e) => {
            if (e.target.id === 'curriculumImportModal') {
                closeCurriculumImport();
            }
        });

        // Load data when page loads
        if (checkAuth()) {
            loadDashboardData();
        }
    </script>
</body>
</html>