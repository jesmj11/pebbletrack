"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Progress } from "@/components/ui/progress"
import { TaskCreationModal } from "@/components/task-creation-modal"
import { ArrowLeft, Plus, Calendar, Trophy, Clock } from "lucide-react"

interface Student {
  id: string
  name: string
  avatar: string
  level: number
  xp: number
  totalXp: number
}

interface Task {
  id: string
  title: string
  subject: string
  dueDate: string
  priority: "low" | "medium" | "high"
  completed: boolean
  xpReward: number
  studentId: string
  description?: string
}

interface ParentDashboardProps {
  students: Student[]
  onBack: () => void
}

export function ParentDashboard({ students, onBack }: ParentDashboardProps) {
  const [showTaskModal, setShowTaskModal] = useState(false)
  const [tasks, setTasks] = useState<Task[]>([
    {
      id: "1",
      title: "Math Practice - Addition",
      subject: "Mathematics",
      dueDate: "2024-01-15",
      priority: "high",
      completed: false,
      xpReward: 50,
      studentId: "1",
      description: "Complete 20 addition problems",
    },
    {
      id: "2",
      title: "Read Chapter 3",
      subject: "Reading",
      dueDate: "2024-01-15",
      priority: "medium",
      completed: true,
      xpReward: 30,
      studentId: "1",
    },
    {
      id: "3",
      title: "Science Experiment",
      subject: "Science",
      dueDate: "2024-01-16",
      priority: "low",
      completed: false,
      xpReward: 75,
      studentId: "2",
    },
  ])

  const addTask = (newTask: Omit<Task, "id">) => {
    const task: Task = {
      ...newTask,
      id: Date.now().toString(),
    }
    setTasks([...tasks, task])
  }

  const toggleTaskCompletion = (taskId: string) => {
    setTasks(tasks.map((task) => (task.id === taskId ? { ...task, completed: !task.completed } : task)))
  }

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case "high":
        return "bg-red-100 text-red-800"
      case "medium":
        return "bg-yellow-100 text-yellow-800"
      case "low":
        return "bg-green-100 text-green-800"
      default:
        return "bg-gray-100 text-gray-800"
    }
  }

  const getSubjectIcon = (subject: string) => {
    switch (subject.toLowerCase()) {
      case "mathematics":
        return "üî¢"
      case "reading":
        return "üìö"
      case "science":
        return "üî¨"
      case "history":
        return "üèõÔ∏è"
      case "art":
        return "üé®"
      default:
        return "üìñ"
    }
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
      <div className="max-w-7xl mx-auto">
        <div className="flex items-center justify-between mb-6">
          <div className="flex items-center gap-4">
            <Button variant="outline" onClick={onBack}>
              <ArrowLeft className="w-4 h-4 mr-2" />
              Back
            </Button>
            <h1 className="text-3xl font-bold text-gray-800">Parent Dashboard</h1>
          </div>
          <Button onClick={() => setShowTaskModal(true)}>
            <Plus className="w-4 h-4 mr-2" />
            Add Task
          </Button>
        </div>

        {/* Student Overview Cards */}
        <div className="grid md:grid-cols-3 gap-6 mb-8">
          {students.map((student) => {
            const studentTasks = tasks.filter((task) => task.studentId === student.id)
            const completedTasks = studentTasks.filter((task) => task.completed).length
            const totalTasks = studentTasks.length
            const completionRate = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0

            return (
              <Card key={student.id} className="hover:shadow-lg transition-shadow">
                <CardHeader className="pb-3">
                  <div className="flex items-center gap-3">
                    <span className="text-3xl">{student.avatar}</span>
                    <div>
                      <CardTitle className="text-lg">{student.name}</CardTitle>
                      <p className="text-sm text-gray-600">Level {student.level}</p>
                    </div>
                  </div>
                </CardHeader>
                <CardContent>
                  <div className="space-y-3">
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span>XP Progress</span>
                        <span>
                          {student.xp}/{student.totalXp}
                        </span>
                      </div>
                      <Progress value={(student.xp / student.totalXp) * 100} className="h-2" />
                    </div>
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span>Tasks Completed</span>
                        <span>
                          {completedTasks}/{totalTasks}
                        </span>
                      </div>
                      <Progress value={completionRate} className="h-2" />
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="flex items-center gap-1">
                        <Trophy className="w-4 h-4 text-yellow-500" />
                        Today's XP
                      </span>
                      <span className="font-semibold">
                        {studentTasks.filter((t) => t.completed).reduce((sum, t) => sum + t.xpReward, 0)}
                      </span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            )
          })}
        </div>

        {/* Tasks Overview */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Calendar className="w-5 h-5" />
              All Tasks
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {tasks.map((task) => {
                const student = students.find((s) => s.id === task.studentId)
                return (
                  <div
                    key={task.id}
                    className={`p-4 rounded-lg border transition-all ${
                      task.completed ? "bg-green-50 border-green-200" : "bg-white border-gray-200"
                    }`}
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                          <span className="text-2xl">{getSubjectIcon(task.subject)}</span>
                          <div>
                            <h3 className={`font-semibold ${task.completed ? "line-through text-gray-500" : ""}`}>
                              {task.title}
                            </h3>
                            <p className="text-sm text-gray-600">
                              {student?.name} ‚Ä¢ {task.subject}
                            </p>
                          </div>
                        </div>
                        {task.description && <p className="text-sm text-gray-600 mb-2">{task.description}</p>}
                        <div className="flex items-center gap-4 text-sm">
                          <Badge className={getPriorityColor(task.priority)}>{task.priority}</Badge>
                          <span className="flex items-center gap-1 text-gray-600">
                            <Clock className="w-4 h-4" />
                            Due: {new Date(task.dueDate).toLocaleDateString()}
                          </span>
                          <span className="flex items-center gap-1 text-purple-600">
                            <Trophy className="w-4 h-4" />
                            {task.xpReward} XP
                          </span>
                        </div>
                      </div>
                      <Button
                        variant={task.completed ? "secondary" : "default"}
                        size="sm"
                        onClick={() => toggleTaskCompletion(task.id)}
                      >
                        {task.completed ? "Completed" : "Mark Complete"}
                      </Button>
                    </div>
                  </div>
                )
              })}
            </div>
          </CardContent>
        </Card>

        <TaskCreationModal
          isOpen={showTaskModal}
          onClose={() => setShowTaskModal(false)}
          onAddTask={addTask}
          students={students}
        />
      </div>
    </div>
  )
}
